
    <h1 class="title is-1">Perfil</h1>

    <% if current_user == @user %>
    <p>¡Bienvenido a tu perfil <u><%=@user.username%></u>! Acá podrás editar tu información.</p>
    <% else %>
    <p>¡Bienvenido al perfil de <u><%=@user.username%></u>! Acá puedes ver la información de su perfil.</p>
    <%end%>
    <div>
    <div>
    <% if @user.profile_pic.attached?%>
        <%= image_tag(@user.profile_pic, size: "100")%>
    <%else%>
        <%= image_tag('default_profile.png', size: "100")%>
    <%end%>    
    </div>


    <div><b>Usuario:</b> <%= @user.username%></div>
    <div><b>Mail:</b> <%= @user.email%></div>
    <div><b>Dirección:</b> <%= @user.address%></div>
    <div><b>Teléfono:</b> <%= @user.phone%></div>


    <% if current_user == @user %>
    <%= link_to "Editar perfil", edit_user_registration_path %>
    <%end%>
    <br>
    <div>
    <% if current_user == @user %>
    <h2 class="title is-3">Mis turnos:</h2>
    <%else%>
    <h2 class="title is-3">Turnos de <%=@user.username%>:</h2>
    <%end%>

   <table align='center' class="table is-striped">
    <thead>
        <tr>
            <th>Usuario</th>
            <th>Direccion de salida</th>
            <th>Direccion de llegada</th>
            <th>Hora del turno</th>
            <th>Fecha del turno</th>
            <th>Limite de personas</th>
            <th colspan='3'></th>
        </tr>
    </thead>
    <tbody>
        <% @publicacions.each do |publicacion|%>
            <tr>
                <% if @user.id == publicacion.user_id%>
                    <th><%= publicacion.post_customer_name%></th>
                    <th><%= publicacion.post_direccion_salida%></th>
                    <th><%= publicacion.post_direccion_llegada%></th>
                    <th><%= publicacion.post_hora.strftime('%H:%M')%></th>
                    <th><%= publicacion.post_day.strftime('%A %d %b %Y')%></th>
                    <th><%= publicacion.post_limit_personas%></th>
                    <th><%= link_to 'Ver Detalles', publicacions_show_path(:id => publicacion.id) %></th>
                <%end%>
                
            </tr>
        <% end %>
    </tbody>
</table>
    <% if current_user == @user %>
    <div>
    <%= link_to 'Ver Mis Solicitudes', requests_index_path, :class => "button is-link is-light" %>
    </div>
    <div>
    <%else%>
    <br>
    <div>

    <% suma_reseña = 0 %>
    <% n = 0 %>
    <% @resenas.each do |resena| %>
        <% if @user.username == resena.receptor %>
            <% suma_reseña += resena.calificacion %>
            <% n += 1 %>
        <%end%>
    <% end %>
    <% promedio_reseña = suma_reseña.to_f/n %>


    <h2 class="title is-3">Reseñas de <%=@user.username%>:</h2>
    <p> Promedio de reseñas: <b><%= promedio_reseña.round(1)%></b> </p>
    <table align='center' class="table is-striped">
    <thead>
        <tr>
            <th>Usuario</th>
            <th>Descripcion</th>
            <th>Calificacion</th>
        </tr>
    </thead>
    <tbody>
        <% @resenas.each do |resena|%>
            <tr>
                <% if @user.username == resena.receptor%>
                    <th><%= resena.emisor%></th>
                    <th><%= resena.texto%></th>
                    <th><%= resena.calificacion%></th>
                    <th><%#= link_to 'Ver Detalles' %></th>
                <%end%>
                
            </tr>
        <% end %>
    </tbody>
    <%end%>
</table>

<% ya_calificado = false %>
<% @resenas.each do |resena|%>
    <% if resena.user_id == current_user.id %>
        <% if resena.receptor == @user.username %>
            <% ya_calificado = true %>                      
        <%end%>
    <%end%>
<%end%>
<% if ya_calificado==false and current_user.id != @user.id %>
    <div>
    <%= link_to 'Escribir Reseña', resenas_new_path(:receptor => @user.username), :class => "button is-link is-light" %>
    </div>
<%end%>

<br>
<div>
<a class="button is-success is-light" href="<%= controllers_index_path %>">Volver atrás</a>
</div>  